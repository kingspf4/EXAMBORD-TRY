<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>期末考看板 - 靜態提醒版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; overflow: hidden; background-color: #f8fafc; }
        
        /* 進度條斜紋動畫 */
        .striped-bar {
            background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
            background-size: 1rem 1rem;
            animation: move-stripes 1s linear infinite;
            transition: width 1s linear, background-color 0.5s ease;
        }
        @keyframes move-stripes { from { background-position: 1rem 0; } to { background-position: 0 0; } }

        /* 輸入框樣式 */
        .clean-input { background: transparent; border-bottom: 2px solid #cbd5e1; transition: all 0.3s; text-align: center; }
        .clean-input:focus { border-bottom-color: #3b82f6; outline: none; background: rgba(255,255,255,0.5); }
        input[type="time"] { font-family: 'Consolas', monospace; cursor: pointer; }

        /* 微調按鈕 */
        .adjust-btn { @apply px-2 py-1 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded text-xs font-bold border border-gray-300 transition-colors; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const App = () => {
            const [now, setNow] = useState(new Date());
            const [offset, setOffset] = useState(() => Number(localStorage.getItem('exam_clock_offset')) || 0);
            const [marqueeText, setMarqueeText] = useState(() => localStorage.getItem('board_marquee') || "請檢查班級、座號、姓名是否填寫正確，考試期間請保持安靜。");
            const [isEditingMarquee, setIsEditingMarquee] = useState(false);
            
            const [schedule, setSchedule] = useState(() => JSON.parse(localStorage.getItem('board_schedule_v2')) || [
                { subject: '國語', supervisor: '王老師', start: '08:40', end: '09:20' },
                { subject: '數學', supervisor: '李老師', start: '09:30', end: '10:10' },
                { subject: '英文', supervisor: '陳老師', start: '10:30', end: '11:10' }
            ]);
            
            const [attendance, setAttendance] = useState(() => JSON.parse(localStorage.getItem('board_attendance')) || { expected: '', actual: '', absent: '' });

            useEffect(() => {
                const timer = setInterval(() => setNow(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                localStorage.setItem('exam_clock_offset', offset);
                localStorage.setItem('board_marquee', marqueeText);
                localStorage.setItem('board_schedule_v2', JSON.stringify(schedule));
                localStorage.setItem('board_attendance', JSON.stringify(attendance));
            }, [offset, marqueeText, schedule, attendance]);

            const adjustedNow = useMemo(() => new Date(now.getTime() + offset), [now, offset]);

            // 計算當前狀態
            const currentStatus = useMemo(() => {
                const currentMs = adjustedNow.getHours() * 3600000 + adjustedNow.getMinutes() * 60000 + adjustedNow.getSeconds() * 1000;
                
                for (let item of schedule) {
                    const [sh, sm] = item.start.split(':').map(Number);
                    const [eh, em] = item.end.split(':').map(Number);
                    const startMs = sh * 3600000 + sm * 60000;
                    const endMs = eh * 3600000 + em * 60000;

                    if (currentMs >= startMs && currentMs < endMs) {
                        const totalDuration = endMs - startMs;
                        const elapsed = currentMs - startMs;
                        const percent = Math.min(100, Math.max(0, (elapsed / totalDuration) * 100));
                        const remainingMinutes = Math.ceil((endMs - currentMs) / 60000);
                        
                        let color = 'bg-green-500';
                        if (remainingMinutes <= 5) color = 'bg-red-600';
                        else if (percent > 50) color = 'bg-yellow-400';

                        return { 
                            active: true, 
                            subject: item.subject, 
                            supervisor: item.supervisor, 
                            percent, color, remaining: remainingMinutes 
                        };
                    }
                }
                return { active: false, subject: '準備中', supervisor: '', percent: 0, color: 'bg-gray-300', remaining: 0 };
            }, [adjustedNow, schedule]);

            const updateSchedule = (index, field, value) => {
                const newSchedule = [...schedule];
                newSchedule[index][field] = value;
                setSchedule(newSchedule);
            };

            const addSubject = () => setSchedule([...schedule, { subject: '', supervisor: '', start: '', end: '' }]);
            const removeSubject = (index) => setSchedule(schedule.filter((_, i) => i !== index));

            return (
                <div className="flex flex-col h-screen w-screen bg-slate-50">
                    
                    {/* A區：頂部大時鐘 + 資訊看板 */}
                    <div className="h-[25vh] bg-white border-b-4 border-gray-200 flex flex-col shadow-sm relative z-20">
                        <div className="flex-[1.5] flex items-center justify-center relative group bg-gray-50/50">
                            {/* 左側微調 */}
                            <div className="flex flex-col gap-2 mr-8 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onClick={() => setOffset(o => o + 60000)} className="adjust-btn text-blue-600 border-blue-200 bg-white">+1 分</button>
                                <button onClick={() => setOffset(o => o + 1000)} className="adjust-btn text-blue-600 border-blue-200 bg-white">+1 秒</button>
                            </div>
                            {/* 大時鐘 */}
                            <div className="flex flex-col items-center">
                                <span className="text-gray-400 font-bold tracking-[0.5em] text-xs uppercase mb-[-5px]">Current Time</span>
                                <div className="text-[10vh] font-black leading-none text-slate-800 tabular-nums drop-shadow-sm">
                                    {adjustedNow.toLocaleTimeString('zh-TW', { hour12: false })}
                                </div>
                            </div>
                            {/* 右側微調 */}
                            <div className="flex flex-col gap-2 ml-8 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onClick={() => setOffset(o => o - 60000)} className="adjust-btn text-red-600 border-red-200 bg-white">-1 分</button>
                                <button onClick={() => setOffset(o => o - 1000)} className="adjust-btn text-red-600 border-red-200 bg-white">-1 秒</button>
                            </div>
                            {/* 剩餘時間 */}
                            {currentStatus.active && (
                                <div className="absolute right-12 flex flex-col items-center animate-pulse">
                                    <span className="text-gray-400 font-bold text-sm">剩餘時間</span>
                                    <div className={`text-[6vh] font-black leading-none ${currentStatus.remaining <= 5 ? 'text-red-600' : 'text-slate-600'}`}>
                                        {currentStatus.remaining}<span className="text-[2vh] ml-1">分</span>
                                    </div>
                                </div>
                            )}
                            <div className="absolute bottom-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                 <button onClick={() => setOffset(0)} className="px-2 py-0.5 bg-gray-200 text-gray-500 rounded text-[10px] font-bold hover:bg-gray-300">重設時鐘</button>
                            </div>
                        </div>

                        <div className="flex-1 bg-white px-8 pb-3 flex flex-col justify-end relative">
                            <div className="flex justify-between items-end mb-2">
                                <div className="flex items-center gap-4">
                                    <span className={`font-black text-4xl drop-shadow-sm ${currentStatus.active ? 'text-blue-700' : 'text-gray-300'}`}>
                                        {currentStatus.subject}
                                    </span>
                                    {currentStatus.active && <span className="text-xs font-bold text-white bg-blue-500 px-2 py-0.5 rounded shadow-sm">考試中</span>}
                                </div>
                                <div className="flex items-center gap-2 bg-slate-100 px-3 py-1 rounded-lg border border-slate-200">
                                    <span className="text-sm font-bold text-gray-400 uppercase">Supervisor</span>
                                    <span className="text-xl font-bold text-slate-700">
                                        {currentStatus.supervisor || "---"}
                                    </span>
                                </div>
                            </div>
                            <div className="w-full h-6 bg-gray-100 rounded-full overflow-hidden shadow-inner border border-gray-200 relative">
                                <div className={`h-full ${currentStatus.color} striped-bar`} style={{ width: `${currentStatus.percent}%` }}></div>
                            </div>
                        </div>
                    </div>

                    {/* B區：靜態公告 (不再跑動) */}
                    <div className="h-[6vh] bg-yellow-400 flex items-center relative border-b-4 border-yellow-500 shadow-md z-10 px-16 justify-center">
                        <div className="absolute left-0 top-0 bottom-0 bg-yellow-600 text-white px-4 flex items-center font-bold z-10 shadow-r-md text-lg">提醒</div>
                        
                        {isEditingMarquee ? (
                            <div className="w-full flex gap-2 max-w-4xl">
                                <input className="flex-1 px-4 py-1 rounded text-lg font-bold outline-none text-center" value={marqueeText} onChange={(e) => setMarqueeText(e.target.value)} autoFocus />
                                <button onClick={() => setIsEditingMarquee(false)} className="bg-black text-white px-4 rounded font-bold">完成</button>
                            </div>
                        ) : (
                            <div 
                                className="w-full text-center text-[3.5vh] font-black text-slate-900 leading-none truncate cursor-pointer hover:opacity-80 transition-opacity" 
                                onClick={() => setIsEditingMarquee(true)} 
                                title="點擊編輯文字"
                            >
                                {marqueeText}
                            </div>
                        )}
                    </div>

                    {/* C區：考程表 */}
                    <div className="flex-1 bg-slate-100 p-4 overflow-y-auto">
                        <div className="max-w-6xl mx-auto bg-white rounded-2xl shadow-lg p-5 border border-slate-200">
                            <div className="flex justify-between items-center mb-3 border-b pb-2">
                                <h2 className="text-xl font-black text-slate-700 border-l-8 border-blue-500 pl-3">考試時間表設定</h2>
                                <button onClick={addSubject} className="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-sm font-bold hover:bg-blue-200 transition">+ 新增科目</button>
                            </div>
                            
                            <div className="space-y-2">
                                {schedule.map((item, i) => {
                                    const isCurrent = currentStatus.subject === item.subject && currentStatus.active;
                                    return (
                                        <div key={i} className={`flex items-center gap-4 p-2 rounded-xl transition-all border-l-4 ${isCurrent ? 'bg-blue-50 border-blue-500 shadow-md scale-[1.01]' : 'bg-slate-50 border-transparent hover:bg-white hover:shadow-sm'}`}>
                                            <div className={`w-8 text-center font-bold text-xl ${isCurrent ? 'text-blue-600' : 'text-gray-400'}`}>{i + 1}</div>
                                            
                                            <input 
                                                className="flex-1 text-2xl font-black clean-input text-left text-slate-800 w-1/3" 
                                                value={item.subject} 
                                                onChange={(e) => updateSchedule(i, 'subject', e.target.value)} 
                                                placeholder="科目"
                                            />

                                            <input 
                                                className="flex-1 text-xl font-bold clean-input text-center text-slate-600 w-1/4" 
                                                value={item.supervisor} 
                                                onChange={(e) => updateSchedule(i, 'supervisor', e.target.value)} 
                                                placeholder="監考老師"
                                            />

                                            <div className="flex items-center gap-2 bg-white px-3 py-1 rounded-lg border">
                                                <input type="time" className="text-xl font-bold outline-none bg-transparent" value={item.start} onChange={(e) => updateSchedule(i, 'start', e.target.value)} />
                                                <span className="text-gray-400 font-bold">~</span>
                                                <input type="time" className="text-xl font-bold outline-none bg-transparent" value={item.end} onChange={(e) => updateSchedule(i, 'end', e.target.value)} />
                                            </div>
                                            <button onClick={() => removeSubject(i)} className="text-gray-300 hover:text-red-500 px-2 font-bold">✕</button>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>

                    {/* D區：底部統計 */}
                    <div className="h-[20vh] bg-slate-800 flex items-stretch p-4 gap-4">
                        <div className="flex-1 bg-blue-600 rounded-2xl flex flex-col items-center justify-center text-white relative shadow-lg overflow-hidden group border border-white/10">
                            <span className="absolute top-2 left-4 text-sm font-bold opacity-70 tracking-widest">EXPECTED / 應到</span>
                            <input type="number" className="w-full bg-transparent text-center text-[9vh] font-black outline-none placeholder-blue-300" value={attendance.expected} onChange={(e) => setAttendance({...attendance, expected: e.target.value})} placeholder="0" />
                        </div>
                        <div className="flex-1 bg-emerald-500 rounded-2xl flex flex-col items-center justify-center text-white relative shadow-lg overflow-hidden border border-white/10">
                            <span className="absolute top-2 left-4 text-sm font-bold opacity-70 tracking-widest">ACTUAL / 實到</span>
                            <input type="number" className="w-full bg-transparent text-center text-[9vh] font-black outline-none placeholder-emerald-200" value={attendance.actual} onChange={(e) => setAttendance({...attendance, actual: e.target.value})} placeholder="0" />
                        </div>
                        <div className="flex-[1.5] bg-rose-600 rounded-2xl flex flex-col relative shadow-lg overflow-hidden p-3 border border-white/10">
                            <span className="absolute top-2 left-4 text-sm font-bold opacity-70 tracking-widest">ABSENT / 缺考名單</span>
                            <textarea className="w-full h-full bg-transparent text-center text-[5vh] font-bold outline-none resize-none pt-6 leading-tight placeholder-rose-300" value={attendance.absent} onChange={(e) => setAttendance({...attendance, absent: e.target.value})} placeholder="輸入座號..." />
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
